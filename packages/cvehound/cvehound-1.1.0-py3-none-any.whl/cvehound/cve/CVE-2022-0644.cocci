/// Files: fs/kernel_read_file.c
/// Fix: 032146cda85566abcd1c4884d9d23e4e30a07e9a
/// Fixes: b844f0ecbc5626ec26cfc70cb144a4c9b85dc3f2

virtual detect

@err@
identifier fd, f, out;
position p;
@@

kernel_read_file_from_fd(int fd, ...)
{
	struct fd f = fdget(fd);
	...
*	if (!f.file)
*		goto out;
	... when != f.file->f_mode & FMODE_READ
*	kernel_read_file@p(f.file, ...)
	...
}

@script:python depends on detect@
p << err.p;
@@

coccilib.report.print_report(p[0], 'ERROR: CVE-2022-0644')
