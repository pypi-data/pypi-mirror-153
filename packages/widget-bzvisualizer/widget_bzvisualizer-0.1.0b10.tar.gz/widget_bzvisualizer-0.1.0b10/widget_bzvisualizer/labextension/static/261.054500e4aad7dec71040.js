(self.webpackChunkwidget_bzvisualizer=self.webpackChunkwidget_bzvisualizer||[]).push([[261],{654:(e,n,o)=>{var i=o(904);i.OrbitControls=function(e,t){var n,o,a,r,s;this.object=e,this.domElement=void 0!==t?t:document,this.enabled=!0,this.target=new i.Vector3,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.25,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.enablePan=!0,this.keyPanSpeed=7,this.autoRotate=!1,this.autoRotateSpeed=2,this.enableKeys=!0,this.keys={LEFT:37,UP:38,RIGHT:39,BOTTOM:40},this.mouseButtons={ORBIT:i.MOUSE.LEFT,ZOOM:i.MOUSE.MIDDLE,PAN:i.MOUSE.RIGHT},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this.getPolarAngle=function(){return b.phi},this.getAzimuthalAngle=function(){return b.theta},this.reset=function(){l.target.copy(l.target0),l.object.position.copy(l.position0),l.object.zoom=l.zoom0,l.object.updateProjectionMatrix(),l.dispatchEvent(c),l.update(),u=h.NONE},this.update=(n=new i.Vector3,o=(new i.Quaternion).setFromUnitVectors(e.up,new i.Vector3(0,1,0)),a=o.clone().inverse(),r=new i.Vector3,s=new i.Quaternion,function(){var e=l.object.position;return n.copy(e).sub(l.target),n.applyQuaternion(o),b.setFromVector3(n),l.autoRotate&&u===h.NONE&&j(2*Math.PI/60/60*l.autoRotateSpeed),b.theta+=f.theta,b.phi+=f.phi,b.theta=Math.max(l.minAzimuthAngle,Math.min(l.maxAzimuthAngle,b.theta)),b.phi=Math.max(l.minPolarAngle,Math.min(l.maxPolarAngle,b.phi)),b.makeSafe(),b.radius*=g,b.radius=Math.max(l.minDistance,Math.min(l.maxDistance,b.radius)),l.target.add(v),n.setFromSpherical(b),n.applyQuaternion(a),e.copy(l.target).add(n),l.object.lookAt(l.target),!0===l.enableDamping?(f.theta*=1-l.dampingFactor,f.phi*=1-l.dampingFactor):f.set(0,0,0),g=1,v.set(0,0,0),!(!(y||r.distanceToSquared(l.object.position)>m||8*(1-s.dot(l.object.quaternion))>m)||(l.dispatchEvent(c),r.copy(l.object.position),s.copy(l.object.quaternion),y=!1))}),this.dispose=function(){l.domElement.removeEventListener("contextmenu",X,!1),l.domElement.removeEventListener("mousedown",Z,!1),l.domElement.removeEventListener("wheel",F,!1),l.domElement.removeEventListener("touchstart",W,!1),l.domElement.removeEventListener("touchend",Y,!1),l.domElement.removeEventListener("touchmove",U,!1),document.removeEventListener("mousemove",H,!1),document.removeEventListener("mouseup",I,!1),window.removeEventListener("keydown",G,!1)};var l=this,c={type:"change"},d={type:"start"},p={type:"end"},h={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_DOLLY:4,TOUCH_PAN:5},u=h.NONE,m=1e-6,b=new i.Spherical,f=new i.Spherical,g=1,v=new i.Vector3,y=!1,w=new i.Vector2,x=new i.Vector2,E=new i.Vector2,M=new i.Vector2,S=new i.Vector2,_=new i.Vector2,V=new i.Vector2,O=new i.Vector2,C=new i.Vector2;function z(){return Math.pow(.95,l.zoomSpeed)}function j(e){f.theta-=e}function L(e){f.phi-=e}var k,B,T,A=(k=new i.Vector3,function(e,t){k.setFromMatrixColumn(t,0),k.multiplyScalar(-e),v.add(k)}),R=(B=new i.Vector3,function(e,t){B.setFromMatrixColumn(t,1),B.multiplyScalar(e),v.add(B)}),N=(T=new i.Vector3,function(e,t){var n,o=l.domElement===document?l.domElement.body:l.domElement;l.object instanceof i.PerspectiveCamera?(n=l.object.position,T.copy(n).sub(l.target),n=T.length(),n*=Math.tan(l.object.fov/2*Math.PI/180),A(2*e*n/o.clientHeight,l.object.matrix),R(2*t*n/o.clientHeight,l.object.matrix)):l.object instanceof i.OrthographicCamera?(A(e*(l.object.right-l.object.left)/l.object.zoom/o.clientWidth,l.object.matrix),R(t*(l.object.top-l.object.bottom)/l.object.zoom/o.clientHeight,l.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),l.enablePan=!1)});function P(e){l.object instanceof i.PerspectiveCamera?g/=e:l.object instanceof i.OrthographicCamera?(l.object.zoom=Math.max(l.minZoom,Math.min(l.maxZoom,l.object.zoom*e)),l.object.updateProjectionMatrix(),y=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),l.enableZoom=!1)}function D(e){l.object instanceof i.PerspectiveCamera?g*=e:l.object instanceof i.OrthographicCamera?(l.object.zoom=Math.max(l.minZoom,Math.min(l.maxZoom,l.object.zoom/e)),l.object.updateProjectionMatrix(),y=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),l.enableZoom=!1)}function Z(e){if(!1!==l.enabled){if(e.preventDefault(),e.button===l.mouseButtons.ORBIT){if(!1===l.enableRotate)return;t=e,w.set(t.clientX,t.clientY),u=h.ROTATE}else if(e.button===l.mouseButtons.ZOOM){if(!1===l.enableZoom)return;t=e,V.set(t.clientX,t.clientY),u=h.DOLLY}else if(e.button===l.mouseButtons.PAN){if(!1===l.enablePan)return;e=e,M.set(e.clientX,e.clientY),u=h.PAN}var t;u!==h.NONE&&(document.addEventListener("mousemove",H,!1),document.addEventListener("mouseup",I,!1),l.dispatchEvent(d))}}function H(e){var t;!1!==l.enabled&&(e.preventDefault(),u===h.ROTATE?!1!==l.enableRotate&&(t=e,x.set(t.clientX,t.clientY),E.subVectors(x,w),t=l.domElement===document?l.domElement.body:l.domElement,j(2*Math.PI*E.x/t.clientWidth*l.rotateSpeed),L(2*Math.PI*E.y/t.clientHeight*l.rotateSpeed),w.copy(x),l.update()):u===h.DOLLY?!1!==l.enableZoom&&(t=e,O.set(t.clientX,t.clientY),C.subVectors(O,V),0<C.y?P(z()):C.y<0&&D(z()),V.copy(O),l.update()):u===h.PAN&&!1!==l.enablePan&&(e=e,S.set(e.clientX,e.clientY),_.subVectors(S,M),N(_.x,_.y),M.copy(S),l.update()))}function I(e){!1!==l.enabled&&(document.removeEventListener("mousemove",H,!1),document.removeEventListener("mouseup",I,!1),l.dispatchEvent(p),u=h.NONE)}function F(e){!1===l.enabled||!1===l.enableZoom||u!==h.NONE&&u!==h.ROTATE||(e.preventDefault(),e.stopPropagation(),(e=e).deltaY<0?D(z()):0<e.deltaY&&P(z()),l.update(),l.dispatchEvent(d),l.dispatchEvent(p))}function G(e){!1!==l.enabled&&!1!==l.enableKeys&&!1!==l.enablePan&&function(e){switch(e.keyCode){case l.keys.UP:N(0,l.keyPanSpeed),l.update();break;case l.keys.BOTTOM:N(0,-l.keyPanSpeed),l.update();break;case l.keys.LEFT:N(l.keyPanSpeed,0),l.update();break;case l.keys.RIGHT:N(-l.keyPanSpeed,0),l.update()}}(e)}function W(e){if(!1!==l.enabled){switch(e.touches.length){case 1:if(!1===l.enableRotate)return;n=e,w.set(n.touches[0].pageX,n.touches[0].pageY),u=h.TOUCH_ROTATE;break;case 2:if(!1===l.enableZoom)return;n=(t=e).touches[0].pageX-t.touches[1].pageX,t=t.touches[0].pageY-t.touches[1].pageY,t=Math.sqrt(n*n+t*t),V.set(0,t),u=h.TOUCH_DOLLY;break;case 3:if(!1===l.enablePan)return;t=e,M.set(t.touches[0].pageX,t.touches[0].pageY),u=h.TOUCH_PAN;break;default:u=h.NONE}var t,n;u!==h.NONE&&l.dispatchEvent(d)}}function U(e){var t,n;if(!1!==l.enabled)switch(e.preventDefault(),e.stopPropagation(),e.touches.length){case 1:if(!1===l.enableRotate)return;if(u!==h.TOUCH_ROTATE)return;n=e,x.set(n.touches[0].pageX,n.touches[0].pageY),E.subVectors(x,w),n=l.domElement===document?l.domElement.body:l.domElement,j(2*Math.PI*E.x/n.clientWidth*l.rotateSpeed),L(2*Math.PI*E.y/n.clientHeight*l.rotateSpeed),w.copy(x),l.update();break;case 2:if(!1===l.enableZoom)return;if(u!==h.TOUCH_DOLLY)return;n=(t=e).touches[0].pageX-t.touches[1].pageX,t=t.touches[0].pageY-t.touches[1].pageY,t=Math.sqrt(n*n+t*t),O.set(0,t),C.subVectors(O,V),0<C.y?D(z()):C.y<0&&P(z()),V.copy(O),l.update();break;case 3:if(!1===l.enablePan)return;if(u!==h.TOUCH_PAN)return;t=e,S.set(t.touches[0].pageX,t.touches[0].pageY),_.subVectors(S,M),N(_.x,_.y),M.copy(S),l.update();break;default:u=h.NONE}}function Y(e){!1!==l.enabled&&(l.dispatchEvent(p),u=h.NONE)}function X(e){e.preventDefault()}l.domElement.addEventListener("contextmenu",X,!1),l.domElement.addEventListener("mousedown",Z,!1),l.domElement.addEventListener("wheel",F,!1),l.domElement.addEventListener("touchstart",W,!1),l.domElement.addEventListener("touchend",Y,!1),l.domElement.addEventListener("touchmove",U,!1),window.addEventListener("keydown",G,!1),this.update()},i.OrbitControls.prototype=Object.create(i.EventDispatcher.prototype),i.OrbitControls.prototype.constructor=i.OrbitControls,Object.defineProperties(i.OrbitControls.prototype,{center:{get:function(){return console.warn("THREE.OrbitControls: .center has been renamed to .target"),this.target}},noZoom:{get:function(){return console.warn("THREE.OrbitControls: .noZoom has been deprecated. Use .enableZoom instead."),!this.enableZoom},set:function(e){console.warn("THREE.OrbitControls: .noZoom has been deprecated. Use .enableZoom instead."),this.enableZoom=!e}},noRotate:{get:function(){return console.warn("THREE.OrbitControls: .noRotate has been deprecated. Use .enableRotate instead."),!this.enableRotate},set:function(e){console.warn("THREE.OrbitControls: .noRotate has been deprecated. Use .enableRotate instead."),this.enableRotate=!e}},noPan:{get:function(){return console.warn("THREE.OrbitControls: .noPan has been deprecated. Use .enablePan instead."),!this.enablePan},set:function(e){console.warn("THREE.OrbitControls: .noPan has been deprecated. Use .enablePan instead."),this.enablePan=!e}},noKeys:{get:function(){return console.warn("THREE.OrbitControls: .noKeys has been deprecated. Use .enableKeys instead."),!this.enableKeys},set:function(e){console.warn("THREE.OrbitControls: .noKeys has been deprecated. Use .enableKeys instead."),this.enableKeys=!e}},staticMoving:{get:function(){return console.warn("THREE.OrbitControls: .staticMoving has been deprecated. Use .enableDamping instead."),!this.enableDamping},set:function(e){console.warn("THREE.OrbitControls: .staticMoving has been deprecated. Use .enableDamping instead."),this.enableDamping=!e}},dynamicDampingFactor:{get:function(){return console.warn("THREE.OrbitControls: .dynamicDampingFactor has been renamed. Use .dampingFactor instead."),this.dampingFactor},set:function(e){console.warn("THREE.OrbitControls: .dynamicDampingFactor has been renamed. Use .dampingFactor instead."),this.dampingFactor=e}}}),i.RenderableObject=function(){this.id=0,this.object=null,this.z=0,this.renderOrder=0},i.RenderableFace=function(){this.id=0,this.v1=new i.RenderableVertex,this.v2=new i.RenderableVertex,this.v3=new i.RenderableVertex,this.normalModel=new i.Vector3,this.vertexNormalsModel=[new i.Vector3,new i.Vector3,new i.Vector3],this.vertexNormalsLength=0,this.color=new i.Color,this.material=null,this.uvs=[new i.Vector2,new i.Vector2,new i.Vector2],this.z=0,this.renderOrder=0},i.RenderableVertex=function(){this.position=new i.Vector3,this.positionWorld=new i.Vector3,this.positionScreen=new i.Vector4,this.visible=!0},i.RenderableVertex.prototype.copy=function(e){this.positionWorld.copy(e.positionWorld),this.positionScreen.copy(e.positionScreen)},i.RenderableLine=function(){this.id=0,this.v1=new i.RenderableVertex,this.v2=new i.RenderableVertex,this.vertexColors=[new i.Color,new i.Color],this.material=null,this.z=0,this.renderOrder=0},i.RenderableSprite=function(){this.id=0,this.object=null,this.x=0,this.y=0,this.z=0,this.rotation=0,this.scale=new i.Vector2,this.material=null,this.renderOrder=0},i.Projector=function(){var e,t,n,o,a,r,s,l,c,d,p,h=[],u=0,m=[],b=0,f=[],g=0,v=[],y=0,w=[],x=0,E={objects:[],lights:[],elements:[]},M=new i.Vector3,S=new i.Vector4,_=new i.Box3(new i.Vector3(-1,-1,-1),new i.Vector3(1,1,1)),V=new i.Box3,O=new Array(3),C=(new Array(4),new i.Matrix4),z=new i.Matrix4,j=new i.Matrix4,L=new i.Matrix3,k=new i.Frustum,B=new i.Vector4,T=new i.Vector4;this.projectVector=function(e,t){console.warn("THREE.Projector: .projectVector() is now vector.project()."),e.project(t)},this.unprojectVector=function(e,t){console.warn("THREE.Projector: .unprojectVector() is now vector.unproject()."),e.unproject(t)},this.pickingRay=function(e,t){console.error("THREE.Projector: .pickingRay() is now raycaster.setFromCamera().")};var A=new function(){var e=[],t=[],o=null,r=null,l=new i.Matrix3;function c(e){var t=e.position,n=e.positionWorld,o=e.positionScreen;n.copy(t).applyMatrix4(p),o.copy(n).applyMatrix4(z),n=1/o.w,o.x*=n,o.y*=n,o.z*=n,e.visible=-1<=o.x&&o.x<=1&&-1<=o.y&&o.y<=1&&-1<=o.z&&o.z<=1}function d(e,t,n){return!0===e.visible||!0===t.visible||!0===n.visible||(O[0]=e.positionScreen,O[1]=t.positionScreen,O[2]=n.positionScreen,_.intersectsBox(V.setFromPoints(O)))}function h(e,t,n){return(n.positionScreen.x-e.positionScreen.x)*(t.positionScreen.y-e.positionScreen.y)-(n.positionScreen.y-e.positionScreen.y)*(t.positionScreen.x-e.positionScreen.x)<0}return{setObject:function(n){r=(o=n).material,l.getNormalMatrix(o.matrixWorld),e.length=0,t.length=0},projectVertex:c,checkTriangleVisibility:d,checkBackfaceCulling:h,pushVertex:function(e,t,o){(n=R()).position.set(e,t,o),c(n)},pushNormal:function(t,n,o){e.push(t,n,o)},pushUv:function(e,n){t.push(e,n)},pushLine:function(e,t){e=m[e],t=m[t],(s=P()).id=o.id,s.v1.copy(e),s.v2.copy(t),s.z=(e.positionScreen.z+t.positionScreen.z)/2,s.renderOrder=o.renderOrder,s.material=o.material,E.elements.push(s)},pushTriangle:function(n,s,c){var p=m[n],u=m[s],b=m[c];if(!1!==d(p,u,b)&&(r.side===i.DoubleSide||!0===h(p,u,b))){(a=N()).id=o.id,a.v1.copy(p),a.v2.copy(u),a.v3.copy(b),a.z=(p.positionScreen.z+u.positionScreen.z+b.positionScreen.z)/3,a.renderOrder=o.renderOrder,a.normalModel.fromArray(e,3*n),a.normalModel.applyMatrix3(l).normalize();for(var f=0;f<3;f++){var g=a.vertexNormalsModel[f];g.fromArray(e,3*arguments[f]),g.applyMatrix3(l).normalize(),a.uvs[f].fromArray(t,2*arguments[f])}a.vertexNormalsLength=3,a.material=o.material,E.elements.push(a)}}}};function R(){if(o!==b)return m[o++];var e=new i.RenderableVertex;return m.push(e),b++,o++,e}function N(){if(r!==g)return f[r++];var e=new i.RenderableFace;return f.push(e),g++,r++,e}function P(){if(l!==y)return v[l++];var e=new i.RenderableLine;return v.push(e),y++,l++,e}function D(e,t){return e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.z!==t.z?t.z-e.z:e.id!==t.id?e.id-t.id:0}this.projectScene=function(n,b,f,g){function v(n){(e=function(){if(t!==u)return h[t++];var e=new i.RenderableObject;return h.push(e),u++,t++,e}()).id=n.id,e.object=n,M.setFromMatrixPosition(n.matrixWorld),M.applyMatrix4(z),e.z=M.z,e.renderOrder=n.renderOrder,E.objects.push(e)}d=l=r=0,!(E.elements.length=0)===n.autoUpdate&&n.updateMatrixWorld(),null===b.parent&&b.updateMatrixWorld(),C.copy(b.matrixWorldInverse.getInverse(b.matrixWorld)),z.multiplyMatrices(b.projectionMatrix,C),k.setFromMatrix(z),t=0,E.objects.length=0,E.lights.length=0,n.traverseVisible((function(e){e instanceof i.Light?E.lights.push(e):e instanceof i.Mesh||e instanceof i.Line?!1!==e.material.visible&&(!0===e.frustumCulled&&!1===k.intersectsObject(e)||v(e)):e instanceof i.Sprite&&!1!==e.material.visible&&(!0===e.frustumCulled&&!1===k.intersectsSprite(e)||v(e))})),!0===f&&E.objects.sort(D);for(var y,_,V,O,Z,H,I,F,G=0,W=E.objects.length;G<W;G++){var U,Y=E.objects[G].object,X=Y.geometry;if(A.setObject(Y),p=Y.matrixWorld,o=0,Y instanceof i.Mesh){if(X instanceof i.BufferGeometry){var q=X.attributes,J=X.groups;if(void 0!==q.position){for(var K=0,Q=(Be=q.position.array).length;K<Q;K+=3)A.pushVertex(Be[K],Be[K+1],Be[K+2]);if(void 0!==q.normal){var $=q.normal.array;for(K=0,Q=$.length;K<Q;K+=3)A.pushNormal($[K],$[K+1],$[K+2])}if(void 0!==q.uv){var ee=q.uv.array;for(K=0,Q=ee.length;K<Q;K+=2)A.pushUv(ee[K],ee[K+1])}if(null!==X.index){var te=X.index.array;if(0<J.length)for(var ne=0;ne<J.length;ne++){var oe=J[ne];for(K=oe.start,Q=oe.start+oe.count;K<Q;K+=3)A.pushTriangle(te[K],te[K+1],te[K+2])}else for(K=0,Q=te.length;K<Q;K+=3)A.pushTriangle(te[K],te[K+1],te[K+2])}else for(K=0,Q=Be.length/3;K<Q;K+=3)A.pushTriangle(K,K+1,K+2)}}else if(X instanceof i.Geometry){var ie=X.vertices,ae=X.faces,re=X.faceVertexUvs[0];L.getNormalMatrix(p);for(var se=(we=Y.material)instanceof i.MultiMaterial,le=1==se?Y.material:null,ce=0,de=ie.length;ce<de;ce++){var pe=ie[ce];if(M.copy(pe),!0===we.morphTargets)for(var he=X.morphTargets,ue=Y.morphTargetInfluences,me=0,be=he.length;me<be;me++){var fe,ge=ue[me];0!==ge&&(fe=he[me].vertices[ce],M.x+=(fe.x-pe.x)*ge,M.y+=(fe.y-pe.y)*ge,M.z+=(fe.z-pe.z)*ge)}A.pushVertex(M.x,M.y,M.z)}for(var ve=0,ye=ae.length;ve<ye;ve++){var we,xe=ae[ve];if(void 0!==(we=1==se?le.materials[xe.materialIndex]:Y.material)){var Ee=we.side,Me=m[xe.a],Se=m[xe.b],_e=m[xe.c];if(!1!==A.checkTriangleVisibility(Me,Se,_e)){var Ve=A.checkBackfaceCulling(Me,Se,_e);if(Ee!==i.DoubleSide){if(Ee===i.FrontSide&&!1===Ve)continue;if(Ee===i.BackSide&&!0===Ve)continue}(a=N()).id=Y.id,a.v1.copy(Me),a.v2.copy(Se),a.v3.copy(_e),a.normalModel.copy(xe.normal),!1!==Ve||Ee!==i.BackSide&&Ee!==i.DoubleSide||a.normalModel.negate(),a.normalModel.applyMatrix3(L).normalize();for(var Oe=xe.vertexNormals,Ce=0,ze=Math.min(Oe.length,3);Ce<ze;Ce++){var je=a.vertexNormalsModel[Ce];je.copy(Oe[Ce]),!1!==Ve||Ee!==i.BackSide&&Ee!==i.DoubleSide||je.negate(),je.applyMatrix3(L).normalize()}a.vertexNormalsLength=Oe.length;var Le=re[ve];if(void 0!==Le)for(var ke=0;ke<3;ke++)a.uvs[ke].copy(Le[ke]);a.color=xe.color,a.material=we,a.z=(Me.positionScreen.z+Se.positionScreen.z+_e.positionScreen.z)/3,a.renderOrder=Y.renderOrder,E.elements.push(a)}}}}}else if(Y instanceof i.Line){if(X instanceof i.BufferGeometry){if(void 0!==(q=X.attributes).position){var Be;for(K=0,Q=(Be=q.position.array).length;K<Q;K+=3)A.pushVertex(Be[K],Be[K+1],Be[K+2]);if(null!==X.index)for(K=0,Q=(te=X.index.array).length;K<Q;K+=2)A.pushLine(te[K],te[K+1]);else{var Te=Y instanceof i.LineSegments?2:1;for(K=0,Q=Be.length/3-1;K<Q;K+=Te)A.pushLine(K,K+1)}}}else if(X instanceof i.Geometry&&(j.multiplyMatrices(z,p),0!==(ie=Y.geometry.vertices).length))for((Me=R()).positionScreen.copy(ie[0]).applyMatrix4(j),Te=Y instanceof i.LineSegments?2:1,ce=1,de=ie.length;ce<de;ce++)(Me=R()).positionScreen.copy(ie[ce]).applyMatrix4(j),0<(ce+1)%Te||(Se=m[o-2],B.copy(Me.positionScreen),T.copy(Se.positionScreen),1==(_=T,O=V=void 0,V=0,O=1,Z=(y=B).z+y.w,H=_.z+_.w,I=-y.z+y.w,F=-_.z+_.w,0<=Z&&0<=H&&0<=I&&0<=F||!(Z<0&&H<0||I<0&&F<0)&&(Z<0?V=Math.max(V,Z/(Z-H)):H<0&&(O=Math.min(O,Z/(Z-H))),I<0?V=Math.max(V,I/(I-F)):F<0&&(O=Math.min(O,I/(I-F))),!(O<V||(y.lerp(_,V),_.lerp(y,1-O),0))))&&(B.multiplyScalar(1/B.w),T.multiplyScalar(1/T.w),(s=P()).id=Y.id,s.v1.positionScreen.copy(B),s.v2.positionScreen.copy(T),s.z=Math.max(B.z,T.z),s.renderOrder=Y.renderOrder,s.material=Y.material,Y.material.vertexColors===i.VertexColors&&(s.vertexColors[0].copy(Y.geometry.colors[ce]),s.vertexColors[1].copy(Y.geometry.colors[ce-1])),E.elements.push(s)))}else Y instanceof i.Sprite&&(S.set(p.elements[12],p.elements[13],p.elements[14],1),S.applyMatrix4(z),U=1/S.w,S.z*=U,-1<=S.z&&S.z<=1&&((c=function(){if(d!==x)return w[d++];var e=new i.RenderableSprite;return w.push(e),x++,d++,e}()).id=Y.id,c.x=S.x*U,c.y=S.y*U,c.z=S.z,c.renderOrder=Y.renderOrder,c.object=Y,c.rotation=Y.rotation,c.scale.x=Y.scale.x*Math.abs(c.x-(S.x+b.projectionMatrix.elements[0])/(S.w+b.projectionMatrix.elements[12])),c.scale.y=Y.scale.y*Math.abs(c.y-(S.y+b.projectionMatrix.elements[5])/(S.w+b.projectionMatrix.elements[13])),c.material=Y.material,E.elements.push(c)))}return!0===g&&E.elements.sort(D),E}},i.SVGObject=function(e){i.Object3D.call(this),this.node=e},i.SVGObject.prototype=Object.create(i.Object3D.prototype),i.SVGObject.prototype.constructor=i.SVGObject,i.SVGRenderer=function(){console.log("THREE.SVGRenderer",i.REVISION);var e,t,n,o,a,r,s,l,c,d,p,h=this,u=new i.Projector,m=document.createElementNS("http://www.w3.org/2000/svg","svg"),b=new i.Box2,f=new i.Box2,g=new i.Color,v=new i.Color,y=new i.Color,w=new i.Color,x=new i.Color,E=new i.Color,M=1,S=new i.Vector3,_=new i.Vector3,V=new i.Vector3,O=new i.Matrix3,C=new i.Matrix4,z=new i.Matrix4,j=[],L=[],k=[],B=0,T=0,A=0,R=1;function N(){for(A=T=B=0;0<m.childNodes.length;)m.removeChild(m.childNodes[0])}this.domElement=m,this.autoClear=!0,this.sortObjects=!0,this.sortElements=!0,this.info={render:{vertices:0,faces:0}},this.setQuality=function(e){switch(e){case"high":R=1;break;case"low":R=0}},this.supportsVertexTextures=function(){},this.setFaceCulling=function(){},this.setClearColor=function(e,t){E.set(e),M=void 0!==t?t:1},this.setPixelRatio=function(){},this.setSize=function(e,t){r=(o=e)/2,s=(a=t)/2,m.setAttribute("viewBox",-r+" "+-s+" "+o+" "+a),m.setAttribute("width",o),m.setAttribute("height",a),b.min.set(-r,-s),b.max.set(r,s)},this.clear=function(){N(),m.style.backgroundColor="rgba("+Math.floor(255*E.r)+","+Math.floor(255*E.g)+","+Math.floor(255*E.b)+","+M+")"},this.render=function(o,a){if(a instanceof i.Camera!=0){var E=o.background;E&&E.isColor?(N(),m.style.backgroundColor="rgb("+Math.floor(255*E.r)+","+Math.floor(255*E.g)+","+Math.floor(255*E.b)+")"):!0===this.autoClear&&this.clear(),h.info.render.vertices=0,h.info.render.faces=0,C.copy(a.matrixWorldInverse.getInverse(a.matrixWorld)),z.multiplyMatrices(a.projectionMatrix,C),e=u.projectScene(o,a,this.sortObjects,this.sortElements),t=e.elements,n=e.lights,O.getNormalMatrix(a.matrixWorldInverse),function(e){y.setRGB(0,0,0),w.setRGB(0,0,0),x.setRGB(0,0,0);for(var t=0,n=e.length;t<n;t++){var o=e[t],a=o.color;o instanceof i.AmbientLight?(y.r+=a.r,y.g+=a.g,y.b+=a.b):o instanceof i.DirectionalLight?(w.r+=a.r,w.g+=a.g,w.b+=a.b):o instanceof i.PointLight&&(x.r+=a.r,x.g+=a.g,x.b+=a.b)}}(n);for(var M,P,D,Z=0,H=t.length;Z<H;Z++){var I=t[Z],F=I.material;void 0!==F&&0!==F.opacity&&(f.makeEmpty(),I instanceof i.RenderableSprite?((l=I).x*=r,l.y*=-s,function(e,t,n){var o=t.scale.x*r;t=t.scale.y*s,(p=function(e){return null!=k[e]||(k[e]=document.createElementNS("http://www.w3.org/2000/svg","rect"),0==R&&k[e].setAttribute("shape-rendering","crispEdges")),k[e]}(A++)).setAttribute("x",e.x-.5*o),p.setAttribute("y",e.y-.5*t),p.setAttribute("width",o),p.setAttribute("height",t),n instanceof i.SpriteMaterial&&p.setAttribute("style","fill: "+n.color.getStyle()),m.appendChild(p)}(l,I,F)):I instanceof i.RenderableLine?(l=I.v1,c=I.v2,l.positionScreen.x*=r,l.positionScreen.y*=-s,c.positionScreen.x*=r,c.positionScreen.y*=-s,f.setFromPoints([l.positionScreen,c.positionScreen]),!0===b.intersectsBox(f)&&(M=l,P=c,D=F,(p=function(e){return null!=L[e]||(L[e]=document.createElementNS("http://www.w3.org/2000/svg","line"),0==R&&L[e].setAttribute("shape-rendering","crispEdges")),L[e]}(T++)).setAttribute("x1",M.positionScreen.x),p.setAttribute("y1",M.positionScreen.y),p.setAttribute("x2",P.positionScreen.x),p.setAttribute("y2",P.positionScreen.y),D instanceof i.LineBasicMaterial&&(p.setAttribute("style","fill: none; stroke: "+D.color.getStyle()+"; stroke-width: "+D.linewidth+"; stroke-opacity: "+D.opacity+"; stroke-linecap: "+D.linecap+"; stroke-linejoin: "+D.linejoin),m.appendChild(p)))):I instanceof i.RenderableFace&&(l=I.v1,c=I.v2,d=I.v3,l.positionScreen.z<-1||1<l.positionScreen.z||c.positionScreen.z<-1||1<c.positionScreen.z||d.positionScreen.z<-1||1<d.positionScreen.z||(l.positionScreen.x*=r,l.positionScreen.y*=-s,c.positionScreen.x*=r,c.positionScreen.y*=-s,d.positionScreen.x*=r,d.positionScreen.y*=-s,f.setFromPoints([l.positionScreen,c.positionScreen,d.positionScreen]),!0===b.intersectsBox(f)&&function(e,t,o,a,r){h.info.render.vertices+=3,h.info.render.faces++,(p=function(e){return null!=j[e]||(j[e]=document.createElementNS("http://www.w3.org/2000/svg","path"),0==R&&j[e].setAttribute("shape-rendering","crispEdges")),j[e]}(B++)).setAttribute("d","M "+e.positionScreen.x+" "+e.positionScreen.y+" L "+t.positionScreen.x+" "+t.positionScreen.y+" L "+o.positionScreen.x+","+o.positionScreen.y+"z"),r instanceof i.MeshBasicMaterial?(g.copy(r.color),r.vertexColors===i.FaceColors&&g.multiply(a.color)):r instanceof i.MeshLambertMaterial||r instanceof i.MeshPhongMaterial?(v.copy(r.color),r.vertexColors===i.FaceColors&&v.multiply(a.color),g.copy(y),_.copy(e.positionWorld).add(t.positionWorld).add(o.positionWorld).divideScalar(3),function(e,t,n,o){for(var a=0,r=e.length;a<r;a++){var s,l,c=e[a],d=c.color;c instanceof i.DirectionalLight?(s=S.setFromMatrixPosition(c.matrixWorld).normalize(),(l=n.dot(s))<=0||(l*=c.intensity,o.r+=d.r*l,o.g+=d.g*l,o.b+=d.b*l)):c instanceof i.PointLight&&(s=S.setFromMatrixPosition(c.matrixWorld),(l=n.dot(S.subVectors(s,t).normalize()))<=0||0!=(l*=0==c.distance?1:1-Math.min(t.distanceTo(s)/c.distance,1))&&(l*=c.intensity,o.r+=d.r*l,o.g+=d.g*l,o.b+=d.b*l))}}(n,_,a.normalModel,g),g.multiply(v).add(r.emissive)):r instanceof i.MeshNormalMaterial&&(V.copy(a.normalModel).applyMatrix3(O),g.setRGB(V.x,V.y,V.z).multiplyScalar(.5).addScalar(.5)),r.wireframe?p.setAttribute("style","fill: none; stroke: "+g.getStyle()+"; stroke-width: "+r.wireframeLinewidth+"; stroke-opacity: "+r.opacity+"; stroke-linecap: "+r.wireframeLinecap+"; stroke-linejoin: "+r.wireframeLinejoin):p.setAttribute("style","fill: "+g.getStyle()+"; fill-opacity: "+r.opacity),m.appendChild(p)}(l,c,d,I,F))))}o.traverseVisible((function(e){var t,n;e instanceof i.SVGObject&&(S.setFromMatrixPosition(e.matrixWorld),S.applyMatrix4(z),t=S.x*r,n=-S.y*s,(e=e.node).setAttribute("transform","translate("+t+","+n+")"),m.appendChild(e))}))}else console.error("THREE.SVGRenderer.render: camera is not an instance of THREE.Camera.")}};var a=function(e,t){return t=void 0!==t&&t,e=(e=(e=(e=(e=e.replace(/GAMMA/gi,"&Gamma;")).replace(/DELTA/gi,"&Delta;")).replace(/SIGMA/gi,"&Sigma;")).replace(/LAMBDA/gi,"&Lambda;")).replace(/\-/gi,"&mdash;"),t?e.replace(/_(.)/gi,(function(e,t,n,o){return'<tspan baseline-shift="sub">'+t+"</tspan>"})):e.replace(/_(.)/gi,(function(e,t,n,o){return"<sub>"+t+"</sub>"}))};e.exports={BZVisualizer:function(e,n,o,r,s){e=void 0===e||e,n=void 0===n||n,o=void 0!==o&&o,s=void 0!==s&&s,r=void 0!==r&&r,console.log("Init BZVisualizer");var l=null,c=[],d=new i.MeshBasicMaterial({color:13975119,opacity:.5,transparent:!0}),p=new i.LineBasicMaterial({color:3355443,opacity:1,transparent:!1,linewidth:1}),h=new i.LineBasicMaterial({color:285405,opacity:1,transparent:!1}),u=new i.MeshBasicMaterial({color:3311805,opacity:1,transparent:!1}),m=new i.MeshBasicMaterial({color:8925746,opacity:1,transparent:!1}),f=null,g=null,v=!1,y=null,w=null,x=null;function E(e){var t=document.createElement("div");t.classList.add(e),t.style.position="absolute",t.style.fontFamily="'Helvetica Neue', Helvetica, Arial, sans-serif",t.style.zIndex=1,t.style.width="100%",t.style.height="100%",t.style.display="table",t.style.top="0px",t.style.left="0px",t.style.textAlign="center",t.style.verticalAlign="middle",t.style.userSelect="none",t.style.userSelect="none",t.style.webkitUserSelect="none",t.style.MozUserSelect="none",t.setAttribute("unselectable","on");var n=document.createElement("span");return n.style.color="rgb(80, 80, 80)",n.style.fontSize="24px",n.style.fontWeight="bold",n.style.backgroundColor="rgba(230,230,230,0.5)",n.style.display="table-cell",n.style.verticalAlign="middle",n.style.lineHeight="normal",n.style.userSelect="none",n.style.userSelect="none",n.style.webkitUserSelect="none",n.style.MozUserSelect="none",n.setAttribute("unselectable","on"),(e=document.createElement("button")).innerHTML="Enable Interaction",e.style.fontSize="20px",e.style.verticalAlign="left",e.classList.add("DouButton"),n.appendChild(e),t.appendChild(n),t}this.loadBZAjax=function(e,t,n){document.getElementById(n).innerHTML="Loading...",$.getJSON(newpath_to_load,(function(e){loadBZ(t,n,e,s)})).fail((function(e,t,o){o=t+", "+o,console.log("Request Failed: "+o),document.getElementById(n).innerHTML="Request Failed: "+o}))},this.resizeRenderer=function(){var e,t;x&&(e=document.getElementById(x),t=window.devicePixelRatio||1,canvas3d_width=e.offsetWidth,canvas3d_height=e.offsetHeight,w&&(g.aspect=canvas3d_width/canvas3d_height,g.updateProjectionMatrix(),w.setSize(canvas3d_width*t,canvas3d_height*t),w.domElement.style.width=canvas3d_width+"px",w.domElement.style.height=canvas3d_height+"px",w.domElement.width=canvas3d_width*t,w.domElement.height=canvas3d_height*t),_())};var M=function(e,t){var n,o;return t=void 0!==t?t:"#000000",r?((o=document.createElementNS("http://www.w3.org/2000/svg","text")).setAttribute("y",-100),o.setAttribute("x",-100),o.setAttribute("font-family","'Helvetica Neue', Helvetica, Arial, sans-serif"),n=window.devicePixelRatio||1,o.setAttribute("font-size",12*n+"px"),o.setAttribute("fill",t),o.innerHTML=e):((o=document.createElement("div")).style.position="absolute",o.style.fontFamily="'Helvetica Neue', Helvetica, Arial, sans-serif",o.style.color=t,o.style.width=100,o.style.height=100,o.style.fontSize="12px",o.innerHTML=e,o.style.top="-100px",o.style.left="-100px",o.style.userSelect="none",o.style.userSelect="none",o.style.webkitUserSelect="none",o.style.MozUserSelect="none",o.setAttribute("unselectable","on"),o.style.pointerEvents="none"),o};function S(e,t){var n,o;return e=e.clone().project(t),t=window.devicePixelRatio||1,r?(n=.5*w.domElement.viewBox.baseVal.width,o=.5*w.domElement.viewBox.baseVal.height,w.domElement.viewBox.baseVal.x,w.domElement.viewBox.baseVal.y,e.x=e.x*n,e.y=-e.y*o):(n=.5*w.getContext().canvas.width/t,o=.5*w.getContext().canvas.height/t,e.x=e.x*n+n,e.y=-e.y*o+o),{left:e.x,top:e.y}}function _(){var e;null!=y?(console.log("setting cam at start of render"),console.log(JSON.stringify(y)),e=new i.Vector3,g.getWorldDirection(e),console.log("worlddir before renderer.render is"),console.log(JSON.stringify(e)),console.log("controls.target=="),console.log(JSON.stringify(l.target))):console.log("camdir == null in render()"),w.render(f,g),r?c.forEach((function(e){pos=e[0],textcontent=e[1],t=2<e.length?(the_color=e[2],M(textcontent,the_color)):M(textcontent),pos2d=S(pos,g),t.setAttribute("y",pos2d.top),t.setAttribute("x",pos2d.left),w.domElement.appendChild(t)})):c.forEach((function(e){pos=e[0],text=e[1],pos2d=S(pos,g),text.style.top=pos2d.top+"px",text.style.left=pos2d.left+"px"}))}this.loadBZ=function(t,s,S,V){x=t;var O=document.getElementById(t);for(t=window.devicePixelRatio||1,document.getElementById(s).innerHTML="";O.firstChild;)O.removeChild(O.firstChild);c=[],s=new i.Vector3,null!=l?(v=!0,console.log(l.getAzimuthalAngle()),k=new i.Vector3(0,0,-1).applyMatrix4(g.matrixWorld),y=k.sub(g.position).normalize(),g.getWorldDirection(s),console.log(JSON.stringify(s))):console.log("controls is null"),f=new i.Scene,canvas3d_width=O.offsetWidth,canvas3d_height=O.offsetHeight,null!=l?(console.log(JSON.stringify(y)),g.lookAt(y),l.target=y,g.getWorldDirection(s),console.log("worlddir after camera declaration is"),console.log(JSON.stringify(s))):console.log("controls is null but probably shouldn't be?"),w.setClearColor(16777215,0),w.setSize(canvas3d_width*t,canvas3d_height*t),w.domElement.style.width=canvas3d_width+"px",w.domElement.style.height=canvas3d_height+"px",w.domElement.width=canvas3d_width*t,w.domElement.height=canvas3d_height*t,O.appendChild(w.domElement),l.addEventListener("change",_),l.enableDamping=!0,l.dampingFactor=.25,l.enableZoom=!0,special_points=S.kpoints,b1=S.b1,b2=S.b2,b3=S.b3,max_b_length=Math.sqrt(Math.max(Math.pow(b1[0],2)+Math.pow(b1[1],2)+Math.pow(b1[2],2),Math.pow(b2[0],2)+Math.pow(b2[1],2)+Math.pow(b2[2],2),Math.pow(b3[0],2)+Math.pow(b3[1],2)+Math.pow(b3[2],2)));var C=1.5*max_b_length;for(j in data=S.faces_data,special_points){pos=special_points[j],radius=.02*max_b_length;var z=new i.SphereGeometry(radius,16,16);(R=new i.Mesh(z,u)).translateX(pos[0]),R.translateY(pos[1]),R.translateZ(pos[2]),f.add(R);var j=a(j,forSVG=r),L=M(j);r?(w.domElement.appendChild(L),c.push([new i.Vector3(pos[0],pos[1],pos[2]),j])):(O.appendChild(L),c.push([new i.Vector3(pos[0],pos[1],pos[2]),L]))}e&&(axesLabels=[[new i.Vector3(1,0,0),'<span style="font-style: italic">x</span>'],[new i.Vector3(0,1,0),'<span style="font-style: italic">y</span>'],[new i.Vector3(0,0,1),'<span style="font-style: italic">z</span>']],r&&(axesLabels=[[new i.Vector3(1,0,0),'<tspan style="font-style: italic">x</tspan>'],[new i.Vector3(0,1,0),'<tspan style="font-style: italic">y</tspan>'],[new i.Vector3(0,0,1),'<tspan style="font-style: italic">z</tspan>']]),axesLabels.forEach((function(e){dir=e[0],j=e[1];var t=new i.Vector3(0,0,0);e=new i.ArrowHelper(dir,t,C,5592405,headLength=C/10,headwidth=C/20),f.add(e),the_color="#555555",L=M(j,color=the_color),pos=dir.clone(),pos.sub(t),pos.multiplyScalar(C),r?(w.domElement.appendChild(L),c.push([pos,j,the_color])):(O.appendChild(L),c.push([pos,L]))})));var k=[[b1,'<span style="font-weight: bold">b</span><sub>1</sub>'],[b2,'<span style="font-weight: bold">b</span><sub>2</sub>'],[b3,'<span style="font-weight: bold">b</span><sub>3</sub>']];r&&(k=[[b1,'<tspan style="font-weight: bold">b</tspan><tspan baseline-shift="sub">1</tspan>'],[b2,'<tspan style="font-weight: bold">b</tspan><tspan baseline-shift="sub">2</tspan>'],[b3,'<tspan style="font-weight: bold">b</tspan><tspan baseline-shift="sub">3</tspan>']]),(k=n?k:[]).forEach((function(e){b=e[0],j=e[1],b_length=Math.sqrt(Math.pow(b[0],2)+Math.pow(b[1],2)+Math.pow(b[2],2)),dir=new i.Vector3(b[0]/b_length,b[1]/b_length,b[2]/b_length);var t=new i.Vector3(0,0,0);e=new i.ArrowHelper(dir,t,length=b_length,0,headLength=b_length/10,headwidth=b_length/20),f.add(e),e=M(j),pos=dir.clone(),pos.sub(t),pos.multiplyScalar(b_length),r?(w.domElement.appendChild(e),c.push([pos,j])):(O.appendChild(e),c.push([pos,e]))}));var B,T=new i.Geometry;if(data.triangles_vertices.forEach((function(e){T.vertices.push(new i.Vector3(e[0],e[1],e[2]))})),data.triangles.forEach((function(e){T.faces.push(new i.Face3(e[0],e[1],e[2]))})),t=new i.Mesh(T,d),geometry=new i.EdgesGeometry(t.geometry),k=new i.LineSegments(geometry,p),f.add(t),f.add(k),path=S.path,path.forEach((function(e){label1=e[0],label2=e[1],p1=special_points[label1],p2=special_points[label2],(e=new i.Geometry).vertices.push(new i.Vector3(p1[0],p1[1],p1[2])),e.vertices.push(new i.Vector3(p2[0],p2[1],p2[2])),(e=new i.Line(e,h)).material.linewidth=4,e.name="pathvectors",f.add(e)})),this.update_pathVector=function(e){console.log("calling update_pathVector");for(var t=f.getObjectByName("pathvectors");t;)t=f.getObjectByName("pathvectors"),f.remove(t);e.forEach((function(e){label1=e[0],label2=e[1],p1=special_points[label1],p2=special_points[label2],(e=new i.Geometry).vertices.push(new i.Vector3(p1[0],p1[1],p1[2])),e.vertices.push(new i.Vector3(p2[0],p2[1],p2[2])),(e=new i.Line(e,h)).material.linewidth=4,e.name="pathvectors",f.add(e)})),_()},o)for(var A in kpoints_abs=S.explicit_kpoints_abs,kpoints_abs){var R;pos=kpoints_abs[A],radius=.005*max_b_length,z=new i.SphereGeometry(radius,16,16),(R=new i.Mesh(z,m)).translateX(pos[0]),R.translateY(pos[1]),R.translateZ(pos[2]),R.name="kpts",f.add(R)}function N(e,t){t=void 0===t?!l.enabled:t,l.enabled=t,elems=O.getElementsByClassName("BZDoubleClickText");for(var n=0;n<elems.length;n++)O.removeChild(elems[n]);t||O.appendChild(E("BZDoubleClickText"))}_(),!1===V&&(N(force_status=!1),myBtn=O.querySelector(".DouButton"),myBtn.onclick=function(){N()}),toggle_visibility=function(e){0===d.opacity?d.opacity=.3:d.opacity=0,d.needsUpdate=!0,_()},this.set_visibility=function(e){d.opacity=e?.3:0,d.needsUpdate=!0,_()};var P=!(this.update_kpts=function(e){for(var t,n=f.getObjectByName("kpts");n;)n=f.getObjectByName("kpts"),f.remove(n);for(t in e){pos=e[t],radius=.008*max_b_length;var o=new i.SphereGeometry(radius,16,16);(o=new i.Mesh(o,m)).translateX(pos[0]),o.translateY(pos[1]),o.translateZ(pos[2]),o.name="kpts",f.add(o)}_()});O.addEventListener("touchend",(function(e){void 0!==B&&clearTimeout(B),P?(P=!1,e.preventDefault(),N()):0==e.targetTouches.length?(P=!0,B=setTimeout((function(){P=!1}),500)):void 0!==B&&(clearTimeout(B),P=!1)})),O.addEventListener("touchcancel",(function(e){void 0!==B&&(clearTimeout(B),P=!1)})),O.addEventListener("touchmove",(function(e){void 0!==B&&(clearTimeout(B),P=!1)})),1==v&&(console.log(JSON.stringify(y)),console.log("setting cam at end of loadbz")),s=new i.Vector3,g.getWorldDirection(s),console.log("worlddir at end of loadbz is"),console.log(JSON.stringify(s))},this.initBZ=function(t,s,v,S){x=t;var V=document.getElementById(t);for(t=window.devicePixelRatio||1,document.getElementById(s).innerHTML="";V.firstChild;)V.removeChild(V.firstChild);c=[],f=new i.Scene,canvas3d_width=V.offsetWidth,canvas3d_height=V.offsetHeight,g=new i.PerspectiveCamera(45,canvas3d_width/canvas3d_height,.01,1e3),null!=l&&(console.log(JSON.stringify(y)),g.getWorldDirection(worlddir),console.log("worlddir after camera declaration is"),console.log(JSON.stringify(worlddir))),r?(w=new i.SVGRenderer).setQuality("high"):w=new i.WebGLRenderer({alpha:!0,preserveDrawingBuffer:!0}),w.setClearColor(16777215,0),w.setSize(canvas3d_width*t,canvas3d_height*t),w.domElement.style.width=canvas3d_width+"px",w.domElement.style.height=canvas3d_height+"px",w.domElement.width=canvas3d_width*t,w.domElement.height=canvas3d_height*t,V.appendChild(w.domElement),(l=new i.OrbitControls(g,w.domElement)).addEventListener("change",_),l.enableDamping=!0,l.dampingFactor=.25,l.enableZoom=!0,special_points=v.kpoints,b1=v.b1,b2=v.b2,b3=v.b3,max_b_length=Math.sqrt(Math.max(Math.pow(b1[0],2)+Math.pow(b1[1],2)+Math.pow(b1[2],2),Math.pow(b2[0],2)+Math.pow(b2[1],2)+Math.pow(b2[2],2),Math.pow(b3[0],2)+Math.pow(b3[1],2)+Math.pow(b3[2],2)));var O=1.5*max_b_length;for(z in g.position.z=3*max_b_length,data=v.faces_data,special_points){pos=special_points[z],radius=.02*max_b_length;var C=new i.SphereGeometry(radius,16,16);(T=new i.Mesh(C,u)).translateX(pos[0]),T.translateY(pos[1]),T.translateZ(pos[2]),f.add(T);var z=a(z,forSVG=r),j=M(z);r?(w.domElement.appendChild(j),c.push([new i.Vector3(pos[0],pos[1],pos[2]),z])):(V.appendChild(j),c.push([new i.Vector3(pos[0],pos[1],pos[2]),j]))}e&&(axesLabels=[[new i.Vector3(1,0,0),'<span style="font-style: italic">x</span>'],[new i.Vector3(0,1,0),'<span style="font-style: italic">y</span>'],[new i.Vector3(0,0,1),'<span style="font-style: italic">z</span>']],r&&(axesLabels=[[new i.Vector3(1,0,0),'<tspan style="font-style: italic">x</tspan>'],[new i.Vector3(0,1,0),'<tspan style="font-style: italic">y</tspan>'],[new i.Vector3(0,0,1),'<tspan style="font-style: italic">z</tspan>']]),axesLabels.forEach((function(e){dir=e[0],z=e[1];var t=new i.Vector3(0,0,0);e=new i.ArrowHelper(dir,t,O,5592405,headLength=O/10,headwidth=O/20),f.add(e),the_color="#555555",j=M(z,color=the_color),pos=dir.clone(),pos.sub(t),pos.multiplyScalar(O),r?(w.domElement.appendChild(j),c.push([pos,z,the_color])):(V.appendChild(j),c.push([pos,j]))}))),s=[[b1,'<span style="font-weight: bold">b</span><sub>1</sub>'],[b2,'<span style="font-weight: bold">b</span><sub>2</sub>'],[b3,'<span style="font-weight: bold">b</span><sub>3</sub>']],r&&(s=[[b1,'<tspan style="font-weight: bold">b</tspan><tspan baseline-shift="sub">1</tspan>'],[b2,'<tspan style="font-weight: bold">b</tspan><tspan baseline-shift="sub">2</tspan>'],[b3,'<tspan style="font-weight: bold">b</tspan><tspan baseline-shift="sub">3</tspan>']]),(s=n?s:[]).forEach((function(e){b=e[0],z=e[1],b_length=Math.sqrt(Math.pow(b[0],2)+Math.pow(b[1],2)+Math.pow(b[2],2)),dir=new i.Vector3(b[0]/b_length,b[1]/b_length,b[2]/b_length);var t=new i.Vector3(0,0,0);e=new i.ArrowHelper(dir,t,length=b_length,0,headLength=b_length/10,headwidth=b_length/20),f.add(e),e=M(z),pos=dir.clone(),pos.sub(t),pos.multiplyScalar(b_length),r?(w.domElement.appendChild(e),c.push([pos,z])):(V.appendChild(e),c.push([pos,e]))}));var L,k=new i.Geometry;if(data.triangles_vertices.forEach((function(e){k.vertices.push(new i.Vector3(e[0],e[1],e[2]))})),data.triangles.forEach((function(e){k.faces.push(new i.Face3(e[0],e[1],e[2]))})),t=new i.Mesh(k,d),geometry=new i.EdgesGeometry(t.geometry),s=new i.LineSegments(geometry,p),f.add(t),f.add(s),path=v.path,path.forEach((function(e){label1=e[0],label2=e[1],p1=special_points[label1],p2=special_points[label2],(e=new i.Geometry).vertices.push(new i.Vector3(p1[0],p1[1],p1[2])),e.vertices.push(new i.Vector3(p2[0],p2[1],p2[2])),(e=new i.Line(e,h)).material.linewidth=4,e.name="pathvectors",f.add(e)})),this.update_pathVector=function(e){console.log("calling update_pathVector");for(var t=f.getObjectByName("pathvectors");t;)t=f.getObjectByName("pathvectors"),f.remove(t);e.forEach((function(e){label1=e[0],label2=e[1],p1=special_points[label1],p2=special_points[label2],(e=new i.Geometry).vertices.push(new i.Vector3(p1[0],p1[1],p1[2])),e.vertices.push(new i.Vector3(p2[0],p2[1],p2[2])),(e=new i.Line(e,h)).material.linewidth=4,e.name="pathvectors",f.add(e)})),_()},o)for(var B in kpoints_abs=v.explicit_kpoints_abs,kpoints_abs){var T;pos=kpoints_abs[B],radius=.005*max_b_length,C=new i.SphereGeometry(radius,16,16),(T=new i.Mesh(C,m)).translateX(pos[0]),T.translateY(pos[1]),T.translateZ(pos[2]),T.name="kpts",f.add(T)}function A(e,t){t=void 0===t?!l.enabled:t,l.enabled=t,elems=V.getElementsByClassName("BZDoubleClickText");for(var n=0;n<elems.length;n++)V.removeChild(elems[n]);t||V.appendChild(E("BZDoubleClickText"))}_(),!1===S&&(A(force_status=!1),myBtn=V.querySelector(".DouButton"),myBtn.onclick=function(){A()}),toggle_visibility=function(e){0===d.opacity?d.opacity=.3:d.opacity=0,d.needsUpdate=!0,_()},this.set_visibility=function(e){d.opacity=e?.3:0,d.needsUpdate=!0,_()};var R=!(this.update_kpts=function(e){for(var t,n=f.getObjectByName("kpts");n;)n=f.getObjectByName("kpts"),f.remove(n);for(t in e){pos=e[t],radius=.008*max_b_length;var o=new i.SphereGeometry(radius,16,16);(o=new i.Mesh(o,m)).translateX(pos[0]),o.translateY(pos[1]),o.translateZ(pos[2]),o.name="kpts",f.add(o)}_()});V.addEventListener("touchend",(function(e){void 0!==L&&clearTimeout(L),R?(R=!1,e.preventDefault(),A()):0==e.targetTouches.length?(R=!0,L=setTimeout((function(){R=!1}),500)):void 0!==L&&(clearTimeout(L),R=!1)})),V.addEventListener("touchcancel",(function(e){void 0!==L&&(clearTimeout(L),R=!1)})),V.addEventListener("touchmove",(function(e){void 0!==L&&(clearTimeout(L),R=!1)}))}}}},163:(e,t,n)=>{var o=n(337),i=n(439),a=n(755),r=n(654).BZVisualizer;n(73);var s=o.DOMWidgetModel.extend({defaults:i.extend(o.DOMWidgetModel.prototype.defaults(),{_model_name:"BrillouinZoneModel",_view_name:"BrillouinZoneView",_model_module:"widget-bzvisualizer",_view_module:"widget-bzvisualizer",_model_module_version:"0.1.0",_view_module_version:"0.1.0",value:"BrillouinZone World!"})}),l=o.DOMWidgetView.extend({initialize:function(){this.canvasID=i.uniqueId("BZCanvas"),this.infoID=i.uniqueId("info"),this.BZVisualizer=new r(!0,!0,!0,!1,!1)},events:{"keypress #BZ-widget":"toggle_faceColor"},render:function(){this.model.on("change:kpts",this.kpts_changed,this),this.model.on("change:face_color",this.faceColor_changed,this),this.model.on("change:path_vectors",this.vectors_changed,this),this.model.on("change:update_structure",this.reloadBZ,this),this.model.on("change:enable_interaction",this.reloadBZ,this),this.height=this.model.get("height"),this.width=this.model.get("width"),this.enableInteraction=this.model.get("enable_interaction"),this.el.innerHTML='<div class="BZ-widget" id="'+this.canvasID+'" style="height:'+this.height+"; width:"+this.width+';"></div><div id="'+this.infoID+'"></div>';var e=this.model.get("jsondata"),t=this.model.get("face_color");that=this,a(document).ready((function(){that.BZVisualizer.initBZ(canvasID=that.canvasID,infoID=that.infoID,e=e,enableInteraction=that.enableInteraction),that.BZVisualizer.set_visibility(t)}))},reloadBZ:function(){console.log("reloadBZ");var e=this.model.get("jsondata"),t=this.model.get("face_color"),n=this.model.get("enable_interaction");this.BZVisualizer.loadBZ(canvasID=this.canvasID,infoID=this.infoID,e=e,n=n),this.BZVisualizer.set_visibility(t)},toggle_faceColor:function(e){if(console.log("The key press is working.********:"+e.keyCode),84==e.keyCode){const e=this.model.get("face_color");this.model.set("face_color",!e),this.touch()}},kpts_changed:function(){const e=this.model.get("kpts");this.BZVisualizer.update_kpts(e)},vectors_changed:function(){const e=this.model.get("path_vectors");this.BZVisualizer.update_pathVector(e)},faceColor_changed:function(){this.BZVisualizer.set_visibility(this.model.get("face_color"))}});e.exports={BrillouinZoneModel:s,BrillouinZoneView:l}},568:(e,t,n)=>{e.exports=n(163),e.exports.version=n(147).version},261:(e,t,n)=>{var o=n(568),i=n(337);e.exports={id:"widget-bzvisualizer:plugin",requires:[i.IJupyterWidgetRegistry],activate:function(e,t){t.registerWidget({name:"widget-bzvisualizer",version:o.version,exports:o})},autoStart:!0}},699:(e,t,n)=>{"use strict";n.d(t,{Z:()=>a});var o=n(645),i=n.n(o)()((function(e){return e[1]}));i.push([e.id,".BZ-widget {\n    width:  100%;\n    height: 450px;\n    align-items: center;\n}\n",""]);const a=i},73:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>r});var o=n(379),i=n.n(o),a=n(699);i()(a.Z,{insert:"head",singleton:!1});const r=a.Z.locals||{}},147:e=>{"use strict";e.exports={version:"0.1.0"}}}]);