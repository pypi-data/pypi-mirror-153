(function(){"use strict";var t={8501:function(t,e,r){var s=r(538),n=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("trame-connect",{attrs:{"use-url":"","forward-errors":""}},[r("trame-server-template",{attrs:{"use-url":""}})],1)},i=[],a=function(){var t=this,e=t.$createElement;t._self._c;return t.ready?t._t("default"):t._e()},o=[],c=(r(6699),r(7807)),l=r(8923),u=r(6215),h=t=>({getArray(e,r=!0){return t.call("viewport.geometry.array.get",[e,r])},getViewState(e,r=!1){return t.call("viewport.geometry.view.get.state",[e,r])},addViewObserver(e){return t.call("viewport.geometry.view.observer.add",[e])},removeViewObserver(e){return t.call("viewport.geometry.view.observer.remove",[e])},subscribeToViewChange(e){return t.subscribe("viewport.geometry.view.subscription",e)},unsubscribe(e){return t.unsubscribe(e)}}),m=t=>({lifeCycleUpdate(e){return t.call("trame.lifecycle.update",[e])},sendError(e){return t.call("trame.error.client",[e])},getState(){return t.call("trame.state.get",[])},trigger(e,r=[],s={}){return t.call("trame.trigger",[e,r,s])},updateState(e){return t.call("trame.state.update",[e])},subscribeToStateUpdate(e){return t.subscribe("trame.state.topic",e)},subscribeToActions(e){return t.subscribe("trame.actions.topic",e)},unsubscribe(e){return t.unsubscribe(e)}}),p={SyncView:h,Trame:m};u.ZP.setSmartConnectClass(l.ZP);const f={},d={"http:":"ws:","https:":"wss:","ws:":"ws:","wss:":"wss:"},y=["unsubscribe","subscribeToViewChange","subscribeToStateUpdate","subscribeToActions","subscribeToViewChange"];function g(t){const e={...t};if(e.sessionURL){let t=e.sessionURL;const r=window.location;if(t.includes("USE_")){const e=new URL(t);e.protocol=d[r.protocol],t=e.toString()}const s={USE_HOSTNAME:r.hostname,USE_HOST:r.host};for(const[e,n]of Object.entries(s))t=t.replaceAll(e,n);e.sessionURL=t}return e.application=document.querySelector("html").dataset.appName||e.application,e.useUrl?{...e,...c.Z.extractURLParameters()}:e}function b(){return u.ZP.newInstance({protocols:p,configDecorator:g,notBusyList:y})}function v(t){let e=f[t]?.client;if(!e){e=b();const r=[],s={type:"created",message:"Client connected..."};function n(e){f[t].status=e}f[t]={client:e,status:s,subscriptions:r},r.push(e.onConnectionError((t=>{n({type:"Connection error",message:t?.response?.error})}))),r.push(e.onConnectionClose((t=>{n({type:"Connection close",message:t?.response?.error})})))}return e}function T(t){return f[t].status}var w={getClient:v,getStatus:T,configDecorator:g},_=r(9274),S=r(7117);const C={};function $(t,e){return t.priority-e.priority}function O(t){C.addAttachement=t}const R={priority:0,async decorate(t){if(null===t||void 0===t)return t;if(t.constructor&&t.constructor===File){const{name:e,lastModified:r,size:s,type:n}=t,i=await t.arrayBuffer(),a=C.addAttachement(i);return{name:e,lastModified:r,size:s,type:n,content:a,_filter:["content"]}}return t}},A={priority:0,async decorate(t){if(null===t||void 0===t)return t;if("string"===typeof t)return t;if(t.constructor&&t.constructor===FileList||t.length){const e=[];for(let r=0;r<t.length;r++)e.push(await R.decorate(t[r]));return e}return t}},E={priority:0,async decorate(t){if(null===t||void 0===t)return t;if("string"===typeof t)return t;if(t.constructor&&t.constructor===Object){const e={},r=Object.keys(t);for(let s=0;s<r.length;s++){const n=r[s];e[n]=t[n],e[n]=await A.decorate(e[n]),e[n]=await R.decorate(e[n])}return e}return t}},U=[R,A,E];function k(t){U.push(t),U.sort($)}async function j(t){let e=t;for(let r=0;r<U.length;r++){if(null===e||void 0===e)return e;e=await U[r].decorate(e)}return e}const x=["type","key","keyCode","controlKey","altKey","shiftKey","position","spinX","spinY","pixelX","pixelY"];function N(t){const e={};for(let r=0;r<x.length;r++){const s=x[r];s in t&&(e[s]=t[s])}return e}var L={event:N};function B(t,e=[],r=1e3,s=2){if(null===t)return null;for(let n=0;n<e.length;n++){const i=Array.isArray(r)?r[n]:r,a=e[n];if(!(t>i))return`${t.toFixed(s)} ${a}`;t/=i}return`${t.toFixed(s)} ${r[r.length-1]}`}function Z(t,e=2){return B(t,["B","KB","MB","GB","TB","PB"],1024,e)}var I={number:B,bytes:Z};function D(t,e,r="application/octet-stream"){const s=new Blob([e],{type:r}),n=URL.createObjectURL(s),i=document.createElement("a");i.setAttribute("href",n),i.setAttribute("download",t),document.body.appendChild(i),i.click(),document.body.removeChild(i),setTimeout((()=>URL.revokeObjectURL(n)),1e3)}function K(t,e=window){let r=e;const s=t.split(".");for(let n=0;n<s.length;n++)r=r[s[n]];return r}function P(t){try{return JSON.stringify(t),t}catch(s){}const e={},r=Object.keys(t);for(let n=0;n<r.length;n++){const i=r[n],a=t[i];if(Array.isArray(a))e[i]=a.map(P);else try{JSON.stringify(a),e[i]=a}catch(s){continue}}return e}var V={download:D,get:K,safe:P,vtk:L,fmt:I};function F(t){const e={tts:0};return t.forEach((t=>{e[t]=0})),new s.Z({data:e})}function M(t,e){function r(t){for(let r=0;r<t.length;r++)e[t[r]]++}return t.$on("stateChange",r),()=>{t.$off("stateChange",r)}}function J(t,e,r){const s={};return e.forEach((e=>{s[e]={get(){return r[e],t.state.get(e)},set(r){t.state.set(e,r)}}})),s}window.trame||(window.trame={}),window.trame.utils||(window.trame.utils=V);const H={},q={};async function z(t,e){for(let r=0;r<t.length;r++)await e(t[r])}function X(t,e){const r=[],s={};for(let a=0;a<t.length;a++){let e=r,n=t[a];if(Array.isArray(n)){const t=n[1].serial;t&&(s[t]||(s[t]=[]),e=s[t]),[n]=n}e.push(n)}const n=r.map(e),i=Object.values(s);for(let a=0;a<i.length;a++)n.push(z(i[a],e));return Promise.all(n)}async function Y(t,e,r=[]){const n=t=>!r.includes(t);t.includes("trame__styles")&&await X(e.trame__styles.filter(n),_.j),t.includes("trame__scripts")&&await X(e.trame__scripts.filter(n),_.ve),t.includes("trame__vue_use")&&e.trame__vue_use.forEach((t=>{let e=t,n={};Array.isArray(t)&&([e,n]=t);let i=V.get(e);i?q[e]||r.includes(e)||(q[e]=!0,i.default&&(i=i.default),console.info(`Vue.use(${e}, ${JSON.stringify(n)}) - ${!!i} - install(${!!i.install})`),i.install?(s.Z.use(i,n),i.getOptions&&Object.assign(H,i.getOptions())):s.Z.use({install:i},n)):console.error(`Lookup error: Vue.use(${e}, ${JSON.stringify(n)})`)})),t.includes("trame__favicon")&&e.trame__favicon&&(document.querySelector("link[rel=icon]").href=e.trame__favicon),t.includes("trame__title")&&e.trame__title&&(document.title=e.trame__title)}class G{constructor(t,e=null,r=[]){this.name="Default trame application",this.vueInstance=t,this.client=t?.client||e,this.exclude=t?.exclude||r,this.subscriptions=[],this.state={},this.keyTS={},this.ts=0,this.trameTemplateTS=0,this.trameTemplate={template:"<div>Too early for trame template</div>"},this.dirtyKeys=new Set,this.registerDecorator=k;const s=async t=>{const e=[],r=Object.keys(t);for(let n=0;n<r.length;n++){let s=!0;const i=r[n],a=t[i];if(a?._filter?.length){s=!1;const t=this.state[i],e=Object.keys(a);for(let r=0;!s&&r<e.length;r++){const n=e[r];"_"!==n[0]&&(void 0!==t&&t[n]===a[n]||(s=!0))}}s&&(e.push(i),this.state[i]=a)}this.ts+=1;let s=0;for(let n=0;n<e.length;n++){const t=e[n];void 0===this.keyTS[t]&&s++,this.keyTS[t]=this.ts}if(await Y(e,this.state,this.exclude),s&&(this.updateTrameTemplate(),this.vueInstance&&this.vueInstance.$emit("trameTemplateChange",this.trameTemplateTS)),this.vueInstance&&(this.vueInstance.$emit("stateChange",e),this.vueInstance.$router&&t?.trame__routes?.length)){const e=this.vueInstance.$router;t.trame__routes.forEach((t=>{e.addRoute(t)}))}};this.subscriptions.push(this.client.getRemote().Trame.subscribeToStateUpdate((([t])=>s(t)))),this.client.getRemote().Trame.getState().then((({state:e,name:r})=>{this.name=r,s(e),t&&(t.ready=!0)})),this._updateFromServer=s}updateTrameTemplate(){if(!this.vueInstance)return;this.trameTemplateTS+=1;const t=Object.keys(this.state),e=F(t),r=M(this.vueInstance,e),s=J(this.vueInstance,t,e);let n=0;this.trameTemplate={name:"TrameTemplate",inject:["trame"],props:{templateName:{type:String,default:"main"}},components:{VRuntimeTemplate:S.Z},computed:{...s,contentTemplate(){const t=`trame__template_${this.templateName}`;return this[t]||`<div>No state variable for ${t} with the following state.<br><pre>${JSON.stringify(this.trame.state.get(),null,2)}</pre></div>`},tts(){return e.tts},utils(){return V}},watch:{contentTemplate(){setTimeout((()=>e.tts+=1),10)}},methods:{set(t,e){return this.trame.state.set(t,e)},get(t=null){return this.trame.state.get(t)},setAll(t){return this.trame.state.update(t)},flushState(...t){return this.trame.state.flush(...t)},registerDecorator(...t){return this.trame.state.registerDecorator(...t)},async trigger(t,e=[],r={}){return await this.trame.client.getRemote().Trame.trigger(t,e,r)},getRef(t){const{trameTemplateRootRef:e}=this.$refs;return e.$refs&&e.$refs[t]?e.$refs[t]:e.$children[0].$refs[t]},execAction(t){const{ref:e,type:r}=t,s=this.getRef(e);if(s&&"method"===r){const{method:e,args:r}=t;s[e](...r)}if(s&&"property"===r){const{property:e,value:r}=t;s[e]=r}}},created(){n++,this.onActions=([t])=>{for(let e=0;e<t.length;e++)this.execAction(t[e])},this.clientSub=this.trame.client.getRemote().Trame.subscribeToActions(this.onActions)},beforeDestroy(){n--,0===n&&r(),this.trame.client.getRemote().Trame.unsubscribe(this.clientSub)},template:'<v-runtime-template ref="trameTemplateRootRef" :template="contentTemplate" />'}}delete(){while(this.subscriptions.length)this.client.getRemote().Trame.unsubscribe(this.subscriptions.pop())}get(t){return void 0===t?this.state:this.state[t]}getTimeStamp(t){return this.keyTS[t]||0}async set(t,e){this.ts+=1,this.state[t]=e,this.keyTS[t]=this.ts,this.dirty(t),await this.flush()}async update(t){this.ts+=1;for(const[e,r]of Object.entries(t))this.state[e]=r,this.keyTS[e]=this.ts,this.dirty(e);await this.flush()}canDirty(t){return!this.state.trame__client_only.includes(t)}dirty(...t){t.forEach((t=>{this.canDirty(t)?this.dirtyKeys.add(t):this.vueInstance&&this.vueInstance.$emit("stateChange",[t])}))}async flush(...t){if(t.length&&t.forEach((t=>{Array.isArray(t)?this.dirty(...t):this.dirty(t)})),this.dirtyKeys.size&&!this.client.isBusy()){const t=[],e=[];this.dirtyKeys.forEach((r=>{t.push(j(this.state[r])),e.push(r)})),this.dirtyKeys.clear();const r=await Promise.all(t),s=e.map(((t,e)=>({key:t,value:r[e]})));await this.client.getRemote().Trame.updateState(s)}this.vueInstance&&!this.vueInstance.connected&&this._updateFromServer(this.state)}}var Q={name:"TrameConnect",props:{name:{type:String,default:"TrameConnect"},config:{type:Object,default:()=>({application:"trame"})},exclude:{type:Array,default:()=>[]},useUrl:{type:Boolean,default:!1},forwardErrors:{type:Boolean,default:!1}},data(){return{ready:!1,connected:!1,busy:1,status:{type:"created",message:"Connecting..."}}},async created(){if(this.subscriptions=[],this.client=w.getClient(this.name),this.subscriptions.push(this.client.onBusyChange((t=>{const e=!t!==!this.busy;this.busy=t,e&&this.state&&this.state.set("trame__busy",t),0===t&&this.state.flush(),e&&this.$emit("busyChange",t)}))),this.subscriptions.push(this.client.onConnectionError((t=>{this.connected=!1,this.status={type:"Connection error",message:t?.response?.error},this.reportError(t?.response?.error||"Connection error"),this.$emit("statusChange",this.status)}))),this.subscriptions.push(this.client.onConnectionClose((t=>{this.connected=!1,this.status={type:"Connection close",message:t?.response?.error},this.reportError(t?.response?.error||"Connection close"),this.$emit("statusChange",this.status)}))),this.client.isConnected()?(this.status=w.getStatus(this.name),this.$emit("statusChange",this.status)):(await this.client.connect(w.configDecorator({...this.config,useUrl:this.useUrl})),O(this.client.getConnection().getSession().addAttachment),this.status={type:"Connected"}),this.connected=this.client.isConnected(),this.busy=this.client.isBusy(),this.$emit("statusChange",this.status),this.connected&&(this.state=new G(this)),this.client.getRemote().Trame.lifeCycleUpdate("client_connected"),window.addEventListener("beforeunload",(()=>this.client.getRemote().Trame.lifeCycleUpdate("client_exited"))),this.forwardErrors){const t=console.error;console.error=(...e)=>{try{this.client.getRemote().Trame.sendError(e.join(" "))}catch(r){t(r)}finally{t(...e)}},window.addEventListener("error",(t=>{console.error(`${t.type}: ${t.message}`)}))}},beforeDestroy(){this.client.getRemote().Trame.lifeCycleUpdate("client_unmounted");while(this.subscriptions.length)this.subscriptions.pop().unsubscribe();this.state&&(this.state.delete(),this.state=null)},methods:{reportError(t="Something unexpected happened..."){this.state.set("trame__template_main",`<trame-loading message="${t}"/>`)},async trigger(t,e=[],r={}){return await this.client.getRemote().Trame.trigger(t,e,r)}},provide(){return{trame:this}}},W=Q,tt=r(1001),et=(0,tt.Z)(W,a,o,!1,null,null,null),rt=et.exports,st=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("trame-template",{key:t.trameTemplateTS,attrs:{templateName:t.tName}})},nt=[],it={name:"TrameServerTemplate",inject:["trame"],props:{templateName:{type:String,default:"main"},urlKey:{type:String,default:"ui"},useUrl:{type:Boolean,default:!1}},data(){return{trameTemplateTS:0}},computed:{tName(){return this.useUrl&&c.Z.extractURLParameters()[this.urlKey]?c.Z.extractURLParameters()[this.urlKey]:this.templateName}},created(){this.onNewTemplate=()=>{this.$options.components.trameTemplate=this.trame.state.trameTemplate,this.trameTemplateTS=this.trame.state.trameTemplateTS},this.trame.$on("trameTemplateChange",this.onNewTemplate),this.onNewTemplate()},beforeDestroy(){this.trame.$off("trameTemplateChange",this.onNewTemplate)}},at=it,ot=(0,tt.Z)(at,st,nt,!1,null,null,null),ct=ot.exports,lt={name:"App",components:{TrameConnect:rt,TrameServerTemplate:ct}},ut=lt,ht=(0,tt.Z)(ut,n,i,!1,null,null,null),mt=ht.exports,pt=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",{class:t.$style.container},[r("div",{class:t.$style.loader}),r("div",{class:t.$style.message},[t._v(" "+t._s(t.message)+" ")])])},ft=[],dt={name:"Loading",props:{message:{type:String,default:"Loading..."}}},yt=dt,gt={container:"style_container_VCsHx",loader:"style_loader_CNsNi",spin:"style_spin_BAaPb",message:"style_message_rmggO"};function bt(t){this["$style"]=gt.locals||gt}var vt=(0,tt.Z)(yt,pt,ft,!1,bt,null,null),Tt=vt.exports,wt=function(){var t=this,e=t.$createElement;t._self._c;return t._t("default",null,null,t.state)},_t=[];function St(...t){const e={};for(let r=0;r<t.length;r++)e[t[r]]=null;return e}function Ct(t,e,...r){return s=>{const{state:n}=t,i=new Set(s);for(let t=0;t<r.length;t++){const s=r[t];i.has(s)&&(e[s]=n.get(s))}}}var $t={inject:["trame"],name:"TrameStateResolver",props:{names:{type:Array,default:()=>[]}},data(){return St(...this.names)},computed:{state(){const t={trame:this.trame,set:(...t)=>this.trame.state.set(...t)};for(let e=0;e<this.names.length;e++){const r=this.names[e];t[r]=this[r]}return t}},created(){this.onStateChange=Ct(this.trame,this,...this.names),this.trame.$on("stateChange",this.onStateChange),this.onStateChange(this.names)},beforeDestroy(){this.trame.$off("stateChange",this.onStateChange)},provide(){return{state:this}}},Ot=$t,Rt=(0,tt.Z)(Ot,wt,_t,!1,null,null,null),At=Rt.exports,Et={TrameApp:mt,TrameConnect:rt,TrameLoading:Tt,TrameServerTemplate:ct,TrameStateResolver:At},Ut={install(t){Object.keys(Et).forEach((e=>{t.component(e,Et[e])}))}};const kt="TrameConnect";function jt(){const t=w.getStatus(kt),e=document.querySelector(".trame__message");e&&(e.innerHTML=t.message||t.type)}async function xt(t){window.Vue=t,t.use(Ut);const e=w.getClient(kt);try{await e.connect(w.configDecorator({application:"trame",useUrl:!0}))}catch(s){return void jt()}e.onConnectionError(jt),e.onConnectionClose(jt),O(e.getConnection().getSession().addAttachment);const{state:r}=await e.getRemote().Trame.getState();await Y(Object.keys(r),r),new t({...H,render:t=>t(mt)}).$mount("#app")}xt(s.Z)}},e={};function r(s){var n=e[s];if(void 0!==n)return n.exports;var i=e[s]={exports:{}};return t[s].call(i.exports,i,i.exports,r),i.exports}r.m=t,function(){var t=[];r.O=function(e,s,n,i){if(!s){var a=1/0;for(u=0;u<t.length;u++){s=t[u][0],n=t[u][1],i=t[u][2];for(var o=!0,c=0;c<s.length;c++)(!1&i||a>=i)&&Object.keys(r.O).every((function(t){return r.O[t](s[c])}))?s.splice(c--,1):(o=!1,i<a&&(a=i));if(o){t.splice(u--,1);var l=n();void 0!==l&&(e=l)}}return e}i=i||0;for(var u=t.length;u>0&&t[u-1][2]>i;u--)t[u]=t[u-1];t[u]=[s,n,i]}}(),function(){r.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return r.d(e,{a:e}),e}}(),function(){r.d=function(t,e){for(var s in e)r.o(e,s)&&!r.o(t,s)&&Object.defineProperty(t,s,{enumerable:!0,get:e[s]})}}(),function(){r.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"===typeof window)return window}}()}(),function(){r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)}}(),function(){var t={143:0};r.O.j=function(e){return 0===t[e]};var e=function(e,s){var n,i,a=s[0],o=s[1],c=s[2],l=0;if(a.some((function(e){return 0!==t[e]}))){for(n in o)r.o(o,n)&&(r.m[n]=o[n]);if(c)var u=c(r)}for(e&&e(s);l<a.length;l++)i=a[l],r.o(t,i)&&t[i]&&t[i][0](),t[i]=0;return r.O(u)},s=self["webpackChunktrame_components"]=self["webpackChunktrame_components"]||[];s.forEach(e.bind(null,0)),s.push=e.bind(null,s.push.bind(s))}();var s=r.O(void 0,[998],(function(){return r(8501)}));s=r.O(s)})();
//# sourceMappingURL=app.1d403fb3.js.map